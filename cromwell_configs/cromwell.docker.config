# include the application.conf at the top
include required(classpath("application"))
 
backend {
	default = "docker"
	providers {
		docker {
		actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
			config {
				concurrent-job-limit = 10
				run-in-background = true

				runtime-attributes = """
				String? docker
				Int? cpu = 16
				Int? memory = 8
				String docker_user = "$EUID"
				"""
				submit = "/bin/bash ${script}"

				submit-docker = """
				docker run \
				--rm -i \
				${"--user " + docker_user} \
				--entrypoint /bin/bash \
				-v ${cwd}:${docker_cwd} \
				-v /mnt/data0/:/mnt/data0/ \
				${docker} < ${script}
				""" 
				caching {
					enabled = true
				}	
			}
		}
	}
}

call-caching {
	enabled = true
}

